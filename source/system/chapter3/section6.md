## 3.6 有关实现的问题

本章节讨论虚拟内存系统在实现会遇到的问题以及解决方案。

### 3.6.1 与分页有关的工作

### 3.6.2 缺页中断处理

缺页中断发生时的事件顺序如下：
1. 硬件陷入内核，在堆栈中保存程序计数器。
2. 启动一个汇编代码例程保存通用寄存器和其他易失的信息，以免被操作系统破坏
3. 当操作系统发现一个缺页中断，尝试发现需要哪个虚拟页面，通常一个硬件寄存器包含了信息，如果没有，操作系统必须检索程序计数器，取出指令并用软件分析。
4. 一旦知道了发生缺页中断的虚拟地址，操作系统检查这个地址是否有效，并检查存取和保护是否一致。如果不一致，向进程发出一个信号kill该进程。如果地址有效且没有发生错误，系统检查是否有空闲页框，如果没有，执行页面置换算法寻找一个页面淘汰。
5. 如果选择的页框脏了，需要将该页写回磁盘，发生一次上下文切换，挂起产生缺页中断的进程，让其他进程运行直到磁盘传输结束，期间该页框标记为忙。
6. 一旦页框干净，操作系统查找所需要的页面在磁盘上的地址，通过磁盘操作将其装入。在该页面被装入时，产生缺页中断的进程仍然被挂起。
7. 磁盘传输完成，发生中断，表示页面已经被装入，页表已经更新，并且页框也被标记为正常。
8. 恢复发生缺页中断指令以前的状态，程序计数器重新指向这条指令。
9. 调度发生缺页中断的进程，操作系统返回调用它的汇编例程。
10. 该例程恢复寄存器和其他状态信息，返回到用户空间继续执行。

### 3.6.3 指令备份

待学习。

### 3.6.4 锁定内存中的页面

待学习。

### 3.6.5 后备存储

待学习。

### 3.6.6 策略与机制的分离

待学习。