## 2.1 进程

### 2.1.1 进程模型

一个进程就是一个正在执行程序的实例，也可以理解为一个进程是某种类型的一个活动，它有程序、输入、输出以及状态。CPU在同一瞬间，其实只能运行一个进程，但是CPU可以快速切换进程，在一段长的时间看来，所有的进程是并行的。

由于CPU在各进程之间的来回切换，所以每个进程执行运算的速度是不确定的。**所以对进程编程时不能对时序做任何想当然的假设**。例如，一个I/O进程，用流式磁带机恢复备份文件，执行一个10000此的空循环以等待磁带机到达正常速度，如果CPU在过程中切换了其他进程，那么可能磁带机到达正常速度时，该进程还没有开始运行。

### 2.1.2 进程创建

首先导致进程创建只有4个主要事件：
1. **系统初始化**：

    在启动操作系统时，系统会创建若干个进程。
2. **正在运行的程序执行了创建进程的系统调用**：

    一个正在运行的进程可以发出系统调用，以便创建一个或多个新进程协助其工作。
3. **用户请求创建一个新进程**：

    在交互式系统中，键入命令或者启动程序会开始一个新的进程。
4. **一个批处理作业的初始化**：

    这一种情形旨在大型机的批处理系统中应用。

#### **创建进程的步骤**

在UNIX系统中，只有一个系统调用可以创建新进程：`fork`，步骤为：
1. 调用`fork`创建与调用进程相同的副本，两个进程拥有相同的内存映像、同样的环境字符串和同样的打开文件。
2. 子进程执行`execve`系统调用，以修改其内存映像并运行一个新的程序。

在Windows中，只需要一个`CreateProcess`系统调用，既可以处理进程的创建，也负责把正确的程序装入新进程。

### 2.1.3 进程的终止

进程的终止通常由下列条件引起：
1. 正常退出（自愿）
2. 出错退出（自愿）
3. 严重错误（非自愿）
4. 被其他进程杀死（非自愿）`kill`

### 2.1.4 进程的层次结构

当进程创建了另一个进程后，父进程和子进程就以某种形式继续保持关联。子进程自身可以创建更多的进程，这些进程共同组成一个**进程组**。

在UNIX中，进程的层次结构很明显，是树状的层次结构，用UNIX启动自己为例：一个名为init的特殊进程出现在启动映像中，参数为终端的数量，接着，该进程会为每一个终端创建一个新进程。这些终端进程会等待用户登录，等用户登录成功，该登录进程就会执行shell准备接受命令，以此类推，系统中所有进程都属于以init为根的一棵树。

### 2.1.5 进程的状态

当一个进程在逻辑上不能继续运行时，进程就会被阻塞。